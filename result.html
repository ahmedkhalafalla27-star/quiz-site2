<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù†ØªÙŠØ¬ØªÙƒ</title>
  <link rel="stylesheet" href="style.css">

  <!-- Facebook Open Graph -->
  <meta property="og:title" content="Ø§Ø®ØªØ¨Ø± Ù‚Ø¯Ø±Ø§ØªÙƒ ÙˆÙ…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ" />
  <meta property="og:description" content="Ø¬Ø±Ø¨ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ§Ø¹Ø±Ù Ù…Ø³ØªÙˆØ§Ùƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ğŸ‘‡" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="" />

  <style>
    .share-btn {
      background: #1877f2;
      color: #fff;
      padding: 14px 26px;
      border-radius: 40px;
      font-size: 18px;
      font-weight: bold;
      text-decoration: none;
      display: inline-block;
      margin-top: 12px;
    }
    .share-btn:hover {
      opacity: 0.9;
    }
  </style>
</head>
<body>

<main class="centered">
  <div class="card result-card" id="resultCard">
    Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªÙŠØ¬Ø©...
  </div>
</main>

<script>
(function () {

  const params = new URLSearchParams(location.search);
  const test = params.get("test");

  const data = JSON.parse(localStorage.getItem(`result_${test}`));

  if (!data) {
    document.getElementById("resultCard").innerHTML = `
      <h2>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªÙŠØ¬Ø©</h2>
      <a class="btn primary" href="index.html">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    `;
    return;
  }

  const percent = Math.round((data.score / data.total) * 100);

  // ğŸ”¹ ØªÙ‚ÙŠÙŠÙ… Ø¹Ø§Ù…
  function evaluate(p) {
    if (p >= 90) return "ğŸ”¥ Ø¹Ø¨Ù‚Ø±ÙŠ Ø­Ù‚ÙŠÙ‚ÙŠ";
    if (p >= 75) return "ğŸ’ª Ø°ÙƒØ§Ø¡ Ù‚ÙˆÙŠ Ø¬Ø¯Ù‹Ø§";
    if (p >= 60) return "ğŸ‘ Ù…Ø³ØªÙˆÙ‰ Ø¬ÙŠØ¯";
    if (p >= 40) return "ğŸ™‚ Ù…ØªÙˆØ³Ø·";
    return "âš ï¸ ÙŠØ­ØªØ§Ø¬ ØªØ·ÙˆÙŠØ±";
  }

  const level = evaluate(percent);

  // ğŸ”¹ Ù†Øµ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
  const shareTexts = {
    iq: `ğŸ§  Ø­ØµÙ„Øª Ø¹Ù„Ù‰ ${percent}% ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø°ÙƒØ§Ø¡! Ù‡Ù„ ØªÙ‚Ø¯Ø± ØªØªØ­Ø¯Ø§Ù†ÙŠØŸ`,
    analytical_thinking: `ğŸ” Ù…Ø³ØªÙˆØ§ÙŠ ${percent}% ÙÙŠ Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠ!`,
    math_logic_iq: `ğŸ§® Ù†ØªÙŠØ¬ØªÙŠ ${percent}% ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠ!`,
    decision_personality: `ğŸ‘¤ Ø´Ø®ØµÙŠØªÙŠ Ø§ØªØ­Ø¯Ø¯Øª! Ù†ØªÙŠØ¬ØªÙŠ ${percent}%`,
    fun_general_knowledge: `ğŸŒ Ù†ØªÙŠØ¬ØªÙŠ ${percent}% ÙÙŠ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©!`,
    football: `âš½ Ø£Ù†Ø§ ÙØ§Ù‡Ù… ÙƒÙˆØ±Ø© Ø¨Ù†Ø³Ø¨Ø© ${percent}% ğŸ˜`,
    quran_hifz: `ğŸ“– Ø§Ø®ØªØ¨Ø±Øª Ø­ÙØ¸ÙŠ Ù„Ù„Ù‚Ø±Ø¢Ù† ÙˆØ·Ù„Ø¹Øª ${percent}%`,
    default: `ğŸ”¥ Ø¬Ø±Ø¨Øª Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯ ÙˆØ·Ù„Ø¹Øª Ù†ØªÙŠØ¬ØªÙŠ ${percent}%`
  };

  const shareText = shareTexts[test] || shareTexts.default;

  const shareUrl = location.origin + "/index.html";

  // ğŸ”¹ Ø±Ø§Ø¨Ø· Ù…Ø´Ø§Ø±ÙƒØ© ÙÙŠØ³Ø¨ÙˆÙƒ (ÙŠÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯)
  const fbAppLink = `fb://facewebmodal/f?href=https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}&quote=${encodeURIComponent(shareText)}`;

  const fbWebLink = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}&quote=${encodeURIComponent(shareText)}`;

  document.getElementById("resultCard").innerHTML = `
    <h2>Ù†ØªÙŠØ¬ØªÙƒ: ${percent}%</h2>
    <div class="score-visual">
      <div class="circle">${data.score} / ${data.total}</div>
    </div>

    <h3>${level}</h3>

    <!-- Ø¥Ø¹Ù„Ø§Ù† Ø£Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªÙŠØ¬Ø© -->
    <div class="ad-slot">Ù…ÙƒØ§Ù† Ø¥Ø¹Ù„Ø§Ù†</div>

    <a href="#" id="shareBtn" class="share-btn">ğŸ“¤ Ø´Ø§Ø±Ùƒ Ù†ØªÙŠØ¬ØªÙƒ Ø¹Ù„Ù‰ ÙÙŠØ³Ø¨ÙˆÙƒ</a>

    <div style="margin-top:14px">
      <a class="btn primary" href="start.html?test=${test}">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</a>
      <a class="btn ghost" href="index.html">Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø£Ø®Ø±Ù‰</a>
    </div>

    <!-- Ø¥Ø¹Ù„Ø§Ù† Ø£Ø³ÙÙ„ Ø§Ù„Ù†ØªÙŠØ¬Ø© -->
    <div class="ad-slot">Ù…ÙƒØ§Ù† Ø¥Ø¹Ù„Ø§Ù†</div>
  `;

  // ğŸ”¹ Ù…Ø­Ø§ÙˆÙ„Ø© ÙØªØ­ ØªØ·Ø¨ÙŠÙ‚ ÙÙŠØ³Ø¨ÙˆÙƒ
  document.getElementById("shareBtn").addEventListener("click", function (e) {
    e.preventDefault();

    const start = Date.now();
    location.href = fbAppLink;

    // Ù„Ùˆ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ â†’ Ø§ÙØªØ­ Ø§Ù„ÙˆÙŠØ¨
    setTimeout(() => {
      if (Date.now() - start < 1500) {
        window.open(fbWebLink, "_blank");
      }
    }, 1000);
  });

})();
</script>

</body>
</html>
